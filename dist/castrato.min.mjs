var index=0,subs={},emits={},noop=function(){};function on(fromId,event,handler,once){var i,item,subscription=[fromId,handler,handler.length>1];(subs[event]||(subs[event]=[])).push(subscription);if(emits[event]){i=0;subscription=[subscription];while(item=emits[event][i++]){emit(0,0,item[0],item[1],subscription);if(once){break}}}}function off(fromId,event,handler){var sub,i=0;if(toSubs=subs[event]){while(sub=toSubs[i++]){if(sub[0]===fromId&&(!handler||handler===sub[1])){toSubs.splice(--i,1)}}}}function emit(persistent,event,data,callback,explicitSubs){var sub,toSubs=explicitSubs||subs[event]||[],total=toSubs.length,left,loop,answers=[],done;if(subs["*"]){toSubs=toSubs.concat(subs["*"])}loop=left=toSubs.length;if(loop){done=!callback?noop:function(data){if(data){answers.push(data)}if(!--left){callback(answers,total);callback=0}};while(sub=toSubs[--loop]){sub[1](data,sub[2]?done:left--,event)}}if(!left&&callback){callback(answers,total)}if(persistent){(emits[event]||(emits[event]=[])).push([data,callback])}}function Castrato(parent){var nodeId=index++;parent=parent||{};parent.emit=function(persistent,event,data,handler){if(persistent!==true&&persistent!==false){handler=data;data=event;event=persistent;persistent=false}emit(persistent,event,data,handler);return this};parent.on=function(event,handler){on(nodeId,event,handler);return this};parent.once=function(event,handler){on(nodeId,event,function wrapper(data,done){off(nodeId,event,wrapper);handler(data,handler.length>1?done:done())},true);return this};parent.off=function(event,handler){off(nodeId,event,handler);return this};parent.destroy=function(){nodeId=0;index=0;subs={};emits={};return this};return parent}let castrato=Castrato();export{castrato,castrato as default};